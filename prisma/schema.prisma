generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model SystemSettings {
  id                   String   @id @default(cuid())
  geminiApiKey         String?
  defaultAttendeeTypes String[] @default([])
  defaultMeetingTypes  String[] @default([])
  defaultTags          String[] @default([])
}

model Event {
  id              String     @id @default(cuid())
  name            String     @unique
  startDate       DateTime?
  endDate         DateTime?
  tags            String[]   @default([])
  meetingTypes    String[]   @default([])
  attendeeTypes   String[]   @default([])
  authorizedUserIds String[] @default([])
  timezone        String?
  url             String?
  address         String?
  requesterEmail  String?
  region          String?
  budget          Float?
  targetCustomers String?
  expectedRoi     String?
  status          String     @default("PIPELINE")
  slug            String     @unique
  attendees       Attendee[]
  meetings        Meeting[]
  rooms           Room[]
}

model Attendee {
  id                 String    @id @default(cuid())
  name               String
  email              String    @unique
  bio                String?
  company            String
  companyDescription String?
  linkedin           String?
  imageUrl           String?
  title              String
  isExternal         Boolean   @default(false)
  type               String?
  eventId            String?
  event              Event?    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  meetings           Meeting[] @relation("AttendeeMeetings")

  @@unique([email, eventId])
}

model Room {
  id       String    @id @default(cuid())
  name     String
  capacity Int
  eventId  String?
  meetings Meeting[]
  event    Event?    @relation(fields: [eventId], references: [id], onDelete: Cascade)
}

model Meeting {
  id                 String        @id @default(cuid())
  title              String
  purpose            String?
  startTime          String?
  endTime            String?
  roomId             String?
  sequence           Int           @default(0)
  status             MeetingStatus @default(PIPELINE)
  tags               String[]      @default([])
  date               String?
  calendarInviteSent Boolean       @default(false)
  createdBy          String?
  isApproved         Boolean       @default(false)
  meetingType        String?
  otherDetails       String?
  requesterEmail     String?
  location           String?
  eventId            String?
  event              Event?        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  room               Room?         @relation(fields: [roomId], references: [id])
  attendees          Attendee[]    @relation("AttendeeMeetings")
}

enum MeetingStatus {
  PIPELINE
  CONFIRMED
  OCCURRED
  CANCELED
}
